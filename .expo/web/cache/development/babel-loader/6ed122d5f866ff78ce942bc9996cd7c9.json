{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { StringFormat } from \"../Clipboard.types\";\nimport { ClipboardUnavailableException, CopyFailureException, NoPermissionException, PasteFailureException } from \"./Exceptions\";\nimport { base64toBlob, blobToBase64Async, findHtmlInClipboardAsync, findImageInClipboardAsync, getImageSizeFromBlobAsync, htmlToPlainText, isClipboardPermissionDeniedAsync } from \"./Utils\";\nexport default {\n  get name() {\n    return 'ExpoClipboard';\n  },\n\n  getStringAsync: function getStringAsync(options) {\n    return function _callee() {\n      var clipboardItems, blob, text, _clipboardItems, _blob, blobText;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (navigator.clipboard) {\n                _context.next = 2;\n                break;\n              }\n\n              throw new ClipboardUnavailableException();\n\n            case 2:\n              _context.prev = 2;\n              _context.t0 = options.preferredFormat;\n              _context.next = _context.t0 === StringFormat.HTML ? 6 : 19;\n              break;\n\n            case 6:\n              _context.next = 8;\n              return _regeneratorRuntime.awrap(navigator.clipboard.read());\n\n            case 8:\n              clipboardItems = _context.sent;\n              _context.next = 11;\n              return _regeneratorRuntime.awrap(findHtmlInClipboardAsync(clipboardItems));\n\n            case 11:\n              blob = _context.sent;\n\n              if (blob) {\n                _context.next = 16;\n                break;\n              }\n\n              _context.next = 15;\n              return _regeneratorRuntime.awrap(navigator.clipboard.readText());\n\n            case 15:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 16:\n              _context.next = 18;\n              return _regeneratorRuntime.awrap(new Response(blob).text());\n\n            case 18:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 19:\n              _context.next = 21;\n              return _regeneratorRuntime.awrap(navigator.clipboard.readText());\n\n            case 21:\n              text = _context.sent;\n\n              if (!(!text || text === '')) {\n                _context.next = 33;\n                break;\n              }\n\n              _context.next = 25;\n              return _regeneratorRuntime.awrap(navigator.clipboard.read());\n\n            case 25:\n              _clipboardItems = _context.sent;\n              _context.next = 28;\n              return _regeneratorRuntime.awrap(findHtmlInClipboardAsync(_clipboardItems));\n\n            case 28:\n              _blob = _context.sent;\n              _context.next = 31;\n              return _regeneratorRuntime.awrap(_blob == null ? void 0 : _blob.text());\n\n            case 31:\n              blobText = _context.sent;\n              text = htmlToPlainText(blobText != null ? blobText : '');\n\n            case 33:\n              return _context.abrupt(\"return\", text);\n\n            case 34:\n              _context.next = 52;\n              break;\n\n            case 36:\n              _context.prev = 36;\n              _context.t1 = _context[\"catch\"](2);\n              _context.t2 = _context.t1.name === 'NotAllowedError';\n\n              if (_context.t2) {\n                _context.next = 43;\n                break;\n              }\n\n              _context.next = 42;\n              return _regeneratorRuntime.awrap(isClipboardPermissionDeniedAsync());\n\n            case 42:\n              _context.t2 = _context.sent;\n\n            case 43:\n              if (!_context.t2) {\n                _context.next = 45;\n                break;\n              }\n\n              throw new NoPermissionException();\n\n            case 45:\n              _context.prev = 45;\n              return _context.abrupt(\"return\", window.clipboardData.getData('Text'));\n\n            case 49:\n              _context.prev = 49;\n              _context.t3 = _context[\"catch\"](45);\n              return _context.abrupt(\"return\", Promise.reject(new Error('Unable to retrieve item from clipboard')));\n\n            case 52:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[2, 36], [45, 49]], Promise);\n    }();\n  },\n  setString: function setString(text) {\n    var textField = document.createElement('textarea');\n    textField.textContent = text;\n    document.body.appendChild(textField);\n    textField.select();\n\n    try {\n      document.execCommand('copy');\n      return true;\n    } catch (_unused2) {\n      return false;\n    } finally {\n      document.body.removeChild(textField);\n    }\n  },\n  setStringAsync: function setStringAsync(text, options) {\n    var _this = this;\n\n    return function _callee2() {\n      var clipboardItemInput;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.t0 = options.inputFormat;\n              _context2.next = _context2.t0 === StringFormat.HTML ? 3 : 22;\n              break;\n\n            case 3:\n              if (navigator.clipboard) {\n                _context2.next = 5;\n                break;\n              }\n\n              throw new ClipboardUnavailableException();\n\n            case 5:\n              _context2.prev = 5;\n              clipboardItemInput = createHtmlClipboardItem(text);\n              _context2.next = 9;\n              return _regeneratorRuntime.awrap(navigator.clipboard.write([clipboardItemInput]));\n\n            case 9:\n              return _context2.abrupt(\"return\", true);\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t1 = _context2[\"catch\"](5);\n              _context2.t2 = _context2.t1.name === 'NotAllowedError';\n\n              if (_context2.t2) {\n                _context2.next = 19;\n                break;\n              }\n\n              _context2.next = 18;\n              return _regeneratorRuntime.awrap(isClipboardPermissionDeniedAsync());\n\n            case 18:\n              _context2.t2 = _context2.sent;\n\n            case 19:\n              if (!_context2.t2) {\n                _context2.next = 21;\n                break;\n              }\n\n              throw new NoPermissionException();\n\n            case 21:\n              throw new CopyFailureException(_context2.t1.message);\n\n            case 22:\n              return _context2.abrupt(\"return\", _this.setString(text));\n\n            case 23:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, [[5, 12]], Promise);\n    }();\n  },\n  hasStringAsync: function hasStringAsync() {\n    return function _callee3() {\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(clipboardHasTypesAsync(['text/plain', 'text/html']));\n\n            case 2:\n              return _context3.abrupt(\"return\", _context3.sent);\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  getImageAsync: function getImageAsync(_options) {\n    return function _callee4() {\n      var clipboardItems, blob, _await$Promise$all, _await$Promise$all2, data, size;\n\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (navigator.clipboard) {\n                _context4.next = 2;\n                break;\n              }\n\n              throw new ClipboardUnavailableException();\n\n            case 2:\n              _context4.prev = 2;\n              _context4.next = 5;\n              return _regeneratorRuntime.awrap(navigator.clipboard.read());\n\n            case 5:\n              clipboardItems = _context4.sent;\n              _context4.next = 8;\n              return _regeneratorRuntime.awrap(findImageInClipboardAsync(clipboardItems));\n\n            case 8:\n              blob = _context4.sent;\n\n              if (blob) {\n                _context4.next = 11;\n                break;\n              }\n\n              return _context4.abrupt(\"return\", null);\n\n            case 11:\n              _context4.next = 13;\n              return _regeneratorRuntime.awrap(Promise.all([blobToBase64Async(blob), getImageSizeFromBlobAsync(blob)]));\n\n            case 13:\n              _await$Promise$all = _context4.sent;\n              _await$Promise$all2 = _slicedToArray(_await$Promise$all, 2);\n              data = _await$Promise$all2[0];\n              size = _await$Promise$all2[1];\n              return _context4.abrupt(\"return\", {\n                data: data,\n                size: size\n              });\n\n            case 20:\n              _context4.prev = 20;\n              _context4.t0 = _context4[\"catch\"](2);\n              _context4.t1 = _context4.t0.name === 'NotAllowedError';\n\n              if (_context4.t1) {\n                _context4.next = 27;\n                break;\n              }\n\n              _context4.next = 26;\n              return _regeneratorRuntime.awrap(isClipboardPermissionDeniedAsync());\n\n            case 26:\n              _context4.t1 = _context4.sent;\n\n            case 27:\n              if (!_context4.t1) {\n                _context4.next = 29;\n                break;\n              }\n\n              throw new NoPermissionException();\n\n            case 29:\n              throw new PasteFailureException(_context4.t0.message);\n\n            case 30:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, [[2, 20]], Promise);\n    }();\n  },\n  setImageAsync: function setImageAsync(base64image) {\n    return function _callee5() {\n      var blob;\n      return _regeneratorRuntime.async(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (navigator.clipboard) {\n                _context5.next = 2;\n                break;\n              }\n\n              throw new ClipboardUnavailableException();\n\n            case 2:\n              _context5.prev = 2;\n              blob = base64toBlob(base64image, 'image/png');\n              _context5.next = 6;\n              return _regeneratorRuntime.awrap(navigator.clipboard.write([new ClipboardItem(_defineProperty({}, blob.type, blob))]));\n\n            case 6:\n              _context5.next = 11;\n              break;\n\n            case 8:\n              _context5.prev = 8;\n              _context5.t0 = _context5[\"catch\"](2);\n              throw new CopyFailureException(_context5.t0.message);\n\n            case 11:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, [[2, 8]], Promise);\n    }();\n  },\n  hasImageAsync: function hasImageAsync() {\n    return function _callee6() {\n      return _regeneratorRuntime.async(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _regeneratorRuntime.awrap(clipboardHasTypesAsync(['image/png', 'image/jpeg']));\n\n            case 2:\n              return _context6.abrupt(\"return\", _context6.sent);\n\n            case 3:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  addClipboardListener: function addClipboardListener() {},\n  removeClipboardListener: function removeClipboardListener() {}\n};\n\nfunction clipboardHasTypesAsync(types) {\n  var clipboardItems;\n  return _regeneratorRuntime.async(function clipboardHasTypesAsync$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          if (navigator.clipboard) {\n            _context7.next = 2;\n            break;\n          }\n\n          throw new ClipboardUnavailableException();\n\n        case 2:\n          _context7.prev = 2;\n          _context7.next = 5;\n          return _regeneratorRuntime.awrap(navigator.clipboard.read());\n\n        case 5:\n          clipboardItems = _context7.sent;\n          return _context7.abrupt(\"return\", clipboardItems.flatMap(function (item) {\n            return item.types;\n          }).some(function (type) {\n            return types.includes(type);\n          }));\n\n        case 9:\n          _context7.prev = 9;\n          _context7.t0 = _context7[\"catch\"](2);\n          _context7.t1 = _context7.t0.name === 'NotAllowedError';\n\n          if (_context7.t1) {\n            _context7.next = 16;\n            break;\n          }\n\n          _context7.next = 15;\n          return _regeneratorRuntime.awrap(isClipboardPermissionDeniedAsync());\n\n        case 15:\n          _context7.t1 = _context7.sent;\n\n        case 16:\n          if (!_context7.t1) {\n            _context7.next = 18;\n            break;\n          }\n\n          throw new NoPermissionException();\n\n        case 18:\n          throw _context7.t0;\n\n        case 19:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, null, null, [[2, 9]], Promise);\n}\n\nfunction createHtmlClipboardItem(htmlString) {\n  return new ClipboardItem({\n    'text/html': new Blob([htmlString], {\n      type: 'text/html'\n    }),\n    'text/plain': new Blob([htmlToPlainText(htmlString)], {\n      type: 'text/plain'\n    })\n  });\n}","map":{"version":3,"mappings":"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","names":["StringFormat","ClipboardUnavailableException","CopyFailureException","NoPermissionException","PasteFailureException","base64toBlob","blobToBase64Async","findHtmlInClipboardAsync","findImageInClipboardAsync","getImageSizeFromBlobAsync","htmlToPlainText","isClipboardPermissionDeniedAsync","name","getStringAsync","options","navigator","clipboard","preferredFormat","HTML","read","clipboardItems","blob","readText","Response","text","blobText","window","clipboardData","getData","Promise","reject","Error","setString","textField","document","createElement","textContent","body","appendChild","select","execCommand","removeChild","setStringAsync","inputFormat","clipboardItemInput","createHtmlClipboardItem","write","message","hasStringAsync","clipboardHasTypesAsync","getImageAsync","_options","all","data","size","setImageAsync","base64image","ClipboardItem","type","hasImageAsync","addClipboardListener","removeClipboardListener","types","flatMap","item","some","includes","htmlString","Blob"],"sourceRoot":"","sources":["../../src/web/ClipboardModule.ts"],"sourcesContent":["import {\n  ClipboardImage,\n  GetImageOptions,\n  GetStringOptions,\n  SetStringOptions,\n  StringFormat,\n} from '../Clipboard.types';\nimport {\n  ClipboardUnavailableException,\n  CopyFailureException,\n  NoPermissionException,\n  PasteFailureException,\n} from './Exceptions';\nimport {\n  base64toBlob,\n  blobToBase64Async,\n  findHtmlInClipboardAsync,\n  findImageInClipboardAsync,\n  getImageSizeFromBlobAsync,\n  htmlToPlainText,\n  isClipboardPermissionDeniedAsync,\n} from './Utils';\n\nexport default {\n  get name(): string {\n    return 'ExpoClipboard';\n  },\n  async getStringAsync(options: GetStringOptions): Promise<string> {\n    if (!navigator.clipboard) {\n      throw new ClipboardUnavailableException();\n    }\n\n    try {\n      switch (options.preferredFormat) {\n        case StringFormat.HTML: {\n          // Try reading HTML first\n          const clipboardItems = await navigator.clipboard.read();\n          const blob = await findHtmlInClipboardAsync(clipboardItems);\n          if (!blob) {\n            // Fall back to plain text\n            return await navigator.clipboard.readText();\n          }\n          return await new Response(blob).text();\n        }\n        default: {\n          let text = await navigator.clipboard.readText();\n          if (!text || text === '') {\n            // If there's no direct plain text, try reading HTML\n            const clipboardItems = await navigator.clipboard.read();\n            const blob = await findHtmlInClipboardAsync(clipboardItems);\n            const blobText = await blob?.text();\n            text = htmlToPlainText(blobText ?? '');\n          }\n          return text;\n        }\n      }\n    } catch (e) {\n      // it might fail, because user denied permission\n      if (e.name === 'NotAllowedError' || (await isClipboardPermissionDeniedAsync())) {\n        throw new NoPermissionException();\n      }\n\n      try {\n        // Internet Explorer\n        // @ts-ignore\n        return window.clipboardData.getData('Text');\n      } catch {\n        return Promise.reject(new Error('Unable to retrieve item from clipboard'));\n      }\n    }\n  },\n  // TODO: (barthap) The `setString` was deprecated in SDK 45. Remove this function in a few SDK cycles.\n  setString(text: string): boolean {\n    const textField = document.createElement('textarea');\n    textField.textContent = text;\n    document.body.appendChild(textField);\n    textField.select();\n    try {\n      document.execCommand('copy');\n      return true;\n    } catch {\n      return false;\n    } finally {\n      document.body.removeChild(textField);\n    }\n  },\n  async setStringAsync(text: string, options: SetStringOptions): Promise<boolean> {\n    switch (options.inputFormat) {\n      case StringFormat.HTML: {\n        if (!navigator.clipboard) {\n          throw new ClipboardUnavailableException();\n        }\n\n        try {\n          const clipboardItemInput = createHtmlClipboardItem(text);\n          await navigator.clipboard.write([clipboardItemInput]);\n          return true;\n        } catch (e) {\n          // it might fail, because user denied permission\n          if (e.name === 'NotAllowedError' || (await isClipboardPermissionDeniedAsync())) {\n            throw new NoPermissionException();\n          }\n          throw new CopyFailureException(e.message);\n        }\n      }\n      default:\n        return this.setString(text);\n    }\n  },\n  async hasStringAsync(): Promise<boolean> {\n    return await clipboardHasTypesAsync(['text/plain', 'text/html']);\n  },\n  async getImageAsync(_options: GetImageOptions): Promise<ClipboardImage | null> {\n    if (!navigator.clipboard) {\n      throw new ClipboardUnavailableException();\n    }\n\n    try {\n      const clipboardItems = await navigator.clipboard.read();\n      const blob = await findImageInClipboardAsync(clipboardItems);\n      if (!blob) {\n        return null;\n      }\n\n      const [data, size] = await Promise.all([\n        blobToBase64Async(blob),\n        getImageSizeFromBlobAsync(blob),\n      ]);\n\n      return { data, size };\n    } catch (e) {\n      // it might fail, because user denied permission\n      if (e.name === 'NotAllowedError' || (await isClipboardPermissionDeniedAsync())) {\n        throw new NoPermissionException();\n      }\n      throw new PasteFailureException(e.message);\n    }\n  },\n  async setImageAsync(base64image: string): Promise<void> {\n    if (!navigator.clipboard) {\n      throw new ClipboardUnavailableException();\n    }\n\n    try {\n      // we set it always to `image/png` because it's the only format supported by the clipboard\n      // but it seems to work even when provided jpeg data\n      const blob = base64toBlob(base64image, 'image/png');\n      await navigator.clipboard.write([\n        // I cannot use `@ts-expect-error` here because some environments consider this correct:\n        // expo-module build - OK,\n        // et gdad - error\n        // Fixed in TS >4.4.3: https://github.com/microsoft/TypeScript/issues/46116#issuecomment-932443415\n        // @ts-ignore Some tools seem to use TS <= 4.4.3\n        new ClipboardItem({\n          [blob.type]: blob,\n        } as Record<string, ClipboardItemDataType>),\n      ]);\n    } catch (err: any) {\n      throw new CopyFailureException(err.message);\n    }\n  },\n  async hasImageAsync(): Promise<boolean> {\n    return await clipboardHasTypesAsync(['image/png', 'image/jpeg']);\n  },\n  addClipboardListener(): void {},\n  removeClipboardListener(): void {},\n};\n\n/**\n * Resolves to true if clipboard has one of provided {@link types}.\n * @throws `ClipboardUnavailableException` if AsyncClipboard API is not available\n * @throws `NoPermissionException` if user denied permission\n */\nasync function clipboardHasTypesAsync(types: string[]): Promise<boolean> {\n  if (!navigator.clipboard) {\n    throw new ClipboardUnavailableException();\n  }\n\n  try {\n    const clipboardItems = await navigator.clipboard.read();\n    return clipboardItems.flatMap((item) => item.types).some((type) => types.includes(type));\n  } catch (e) {\n    // it might fail, because user denied permission\n    if (e.name === 'NotAllowedError' || (await isClipboardPermissionDeniedAsync())) {\n      throw new NoPermissionException();\n    }\n    throw e;\n  }\n}\n\nfunction createHtmlClipboardItem(htmlString: string): ClipboardItem {\n  return new ClipboardItem({\n    // @ts-ignore `Blob` from `lib.dom.d.ts` and the one from `@types/react-native` differ\n    'text/html': new Blob([htmlString], { type: 'text/html' }),\n    // @ts-ignore `Blob` from `lib.dom.d.ts` and the one from `@types/react-native` differ\n    'text/plain': new Blob([htmlToPlainText(htmlString)], { type: 'text/plain' }),\n  });\n}\n"]},"metadata":{},"sourceType":"module"}